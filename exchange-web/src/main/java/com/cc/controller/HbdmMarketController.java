package com.cc.controller;

import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.cc.common.constant.ExchangeCST;
import com.cc.common.controller.BaseController;
import com.cc.common.huobi.model.ContractVO;
import com.cc.common.huobi.model.HuobiListResult;
import com.cc.common.huobi.model.HuobiTickResult;
import com.cc.common.huobi.model.KLineVO;
import com.cc.common.util.CommonUtil;
import com.hbdm.api.HbdmMarketService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.ArrayList;
import java.util.List;

/**
 * @author chencheng0816@gmail.com
 * @date 2019/6/6 20:36
 * @Description HbdmMarketController
 */
@Transactional
@Controller
@RequestMapping("hbdm/market")
public class HbdmMarketController extends BaseController {
	@Autowired
	private HbdmMarketService hbdmMarketService;

	@ResponseBody
	@RequestMapping("history/kline")
	public String kline(String symbol, String period, Integer size) {
		initResultMap();

		HuobiListResult<KLineVO> result = new HuobiListResult<>();
		if (ExchangeCST.ENV_DEV) {
			String resStr = "{\"data\":[{\"id\":1742346900,\"open\":82881.46,\"close\":82867.72,\"high\":82904.76,\"low\":82793.66,\"amount\":0.07242078207599217,\"vol\":60,\"count\":19},{\"id\":1742347800,\"open\":82835.24,\"close\":82866.37,\"high\":82905.68,\"low\":82793.66,\"amount\":0.06034552913159956,\"vol\":50,\"count\":18},{\"id\":1742348700,\"open\":82884.44,\"close\":82847.53,\"high\":83001.71,\"low\":82750.75,\"amount\":0.06757024828199572,\"vol\":56,\"count\":18},{\"id\":1742349600,\"open\":82768.64,\"close\":82727.65,\"high\":82813.5,\"low\":82518.95,\"amount\":0.07015569372937988,\"vol\":58,\"count\":20},{\"id\":1742350500,\"open\":82688.4,\"close\":82763.09,\"high\":82810.3,\"low\":82648.63,\"amount\":0.05802647528539896,\"vol\":48,\"count\":21},{\"id\":1742351400,\"open\":82668.84,\"close\":82798.64,\"high\":82855.24,\"low\":82603.4,\"amount\":0.05801188981306372,\"vol\":48,\"count\":19},{\"id\":1742352300,\"open\":82821.65,\"close\":82864.17,\"high\":82864.17,\"low\":82742.66,\"amount\":0.06764386640398883,\"vol\":56,\"count\":21},{\"id\":1742353200,\"open\":82848.66,\"close\":82871.47,\"high\":82983.64,\"low\":82815.62,\"amount\":0.07961123801612299,\"vol\":66,\"count\":20},{\"id\":1742354100,\"open\":82920.88,\"close\":82777.51,\"high\":82920.88,\"low\":82760.89,\"amount\":0.07484393082129553,\"vol\":62,\"count\":19},{\"id\":1742355000,\"open\":82800.68,\"close\":82913.28,\"high\":82927.8,\"low\":82787.27,\"amount\":0.06756746330702344,\"vol\":56,\"count\":19},{\"id\":1742355900,\"open\":82936.21,\"close\":83034.07,\"high\":83051.45,\"low\":82858.97,\"amount\":0.06510290002692519,\"vol\":54,\"count\":19},{\"id\":1742356800,\"open\":83017.66,\"close\":82906.37,\"high\":83039.83,\"low\":82864.9,\"amount\":0.06269763068126206,\"vol\":52,\"count\":18},{\"id\":1742357700,\"open\":82884.24,\"close\":82828.67,\"high\":82921.99,\"low\":82828.67,\"amount\":0.05550612906626363,\"vol\":46,\"count\":17},{\"id\":1742358600,\"open\":82836.95,\"close\":82938.24,\"high\":82972.14,\"low\":82764.4,\"amount\":0.07240736323791361,\"vol\":60,\"count\":20},{\"id\":1742359500,\"open\":82922.8,\"close\":82948.31,\"high\":83000.91,\"low\":82886.72,\"amount\":0.07234447928087806,\"vol\":60,\"count\":19},{\"id\":1742360400,\"open\":82985.7,\"close\":82936.34,\"high\":83006.66,\"low\":82936.34,\"amount\":0.07230868606768674,\"vol\":60,\"count\":20},{\"id\":1742361300,\"open\":82943.94,\"close\":83015.28,\"high\":83085.4,\"low\":82912.9,\"amount\":0.06990844954963908,\"vol\":58,\"count\":20},{\"id\":1742362200,\"open\":82977.38,\"close\":83120.72,\"high\":83228.28,\"low\":82947.15,\"amount\":0.0698134800235965,\"vol\":58,\"count\":20},{\"id\":1742363100,\"open\":83167.45,\"close\":83221.23,\"high\":83285.47,\"low\":83117.41,\"amount\":0.07211343331163764,\"vol\":60,\"count\":20},{\"id\":1742364000,\"open\":83201.73,\"close\":83258.26,\"high\":83263.98,\"low\":83140.01,\"amount\":0.060100763697309274,\"vol\":50,\"count\":19},{\"id\":1742364900,\"open\":83244.28,\"close\":83180.2,\"high\":83284.91,\"low\":83123.91,\"amount\":0.06489302913063327,\"vol\":54,\"count\":19},{\"id\":1742365800,\"open\":83161.6,\"close\":83166.84,\"high\":83251.78,\"low\":83109.31,\"amount\":0.06010546078178155,\"vol\":50,\"count\":16},{\"id\":1742366700,\"open\":83156.28,\"close\":83149.39,\"high\":83223.03,\"low\":83105.05,\"amount\":0.06734308991011982,\"vol\":56,\"count\":19},{\"id\":1742367600,\"open\":83195.22,\"close\":83138.3,\"high\":83210.54,\"low\":83097.77,\"amount\":0.07696455949124786,\"vol\":64,\"count\":20},{\"id\":1742368500,\"open\":83159.01,\"close\":83250.79,\"high\":83302.38,\"low\":83159.01,\"amount\":0.07448675855712908,\"vol\":62,\"count\":18},{\"id\":1742369400,\"open\":83269.79,\"close\":83149.02,\"high\":83343.19,\"low\":83109.64,\"amount\":0.0769033033514748,\"vol\":64,\"count\":19},{\"id\":1742370300,\"open\":83133.91,\"close\":83169.73,\"high\":83212.09,\"low\":83094.7,\"amount\":0.060116946446706836,\"vol\":50,\"count\":17},{\"id\":1742371200,\"open\":83179.15,\"close\":83318.14,\"high\":83378.09,\"low\":83179.15,\"amount\":0.06003444662927615,\"vol\":50,\"count\":17},{\"id\":1742372100,\"open\":83333.99,\"close\":83389.18,\"high\":83389.18,\"low\":83262.1,\"amount\":0.062403214014283934,\"vol\":52,\"count\":18},{\"id\":1742373000,\"open\":83370.6,\"close\":83373.83,\"high\":83480.66,\"low\":83340.27,\"amount\":0.06953942217144704,\"vol\":58,\"count\":18},{\"id\":1742373900,\"open\":83375.9,\"close\":83416.02,\"high\":83480.68,\"low\":83375.9,\"amount\":0.0719210491973894,\"vol\":60,\"count\":19},{\"id\":1742374800,\"open\":83442.83,\"close\":83441.58,\"high\":83505.86,\"low\":83357.32,\"amount\":0.06471979100498983,\"vol\":54,\"count\":18},{\"id\":1742375700,\"open\":83455.45,\"close\":83563.55,\"high\":83565.41,\"low\":83455.45,\"amount\":0.07663217099499561,\"vol\":64,\"count\":21},{\"id\":1742376600,\"open\":83551.88,\"close\":83448.62,\"high\":83597.52,\"low\":83447.05,\"amount\":0.07182220897038456,\"vol\":60,\"count\":19},{\"id\":1742377500,\"open\":83412.25,\"close\":83559.36,\"high\":83559.36,\"low\":83412.25,\"amount\":0.06947128821482237,\"vol\":58,\"count\":20},{\"id\":1742378400,\"open\":83581.7,\"close\":83550.15,\"high\":83652.19,\"low\":83448.1,\"amount\":0.06941575948397102,\"vol\":58,\"count\":17},{\"id\":1742379300,\"open\":83532.7,\"close\":83565.48,\"high\":83575.86,\"low\":83494.4,\"amount\":0.05506013332078771,\"vol\":46,\"count\":18},{\"id\":1742380200,\"open\":83544.05,\"close\":83574.78,\"high\":83725.61,\"low\":83415.35,\"amount\":0.09089593873420876,\"vol\":76,\"count\":20},{\"id\":1742381100,\"open\":83528.7,\"close\":83522.32,\"high\":83603.75,\"low\":83465.56,\"amount\":0.06943097218671178,\"vol\":58,\"count\":18},{\"id\":1742382000,\"open\":83493.71,\"close\":83630.49,\"high\":83711.94,\"low\":83375.51,\"amount\":0.07425936277565266,\"vol\":62,\"count\":19},{\"id\":1742382900,\"open\":83692.23,\"close\":83749.5,\"high\":83864.96,\"low\":83624.93,\"amount\":0.08834673812655314,\"vol\":74,\"count\":21},{\"id\":1742383800,\"open\":83770.63,\"close\":83989.34,\"high\":84054.65,\"low\":83743.53,\"amount\":0.08104286464780429,\"vol\":68,\"count\":21},{\"id\":1742384700,\"open\":83977.03,\"close\":83877.33,\"high\":83977.03,\"low\":83790.18,\"amount\":0.06675746787202318,\"vol\":56,\"count\":20},{\"id\":1742385600,\"open\":83880.45,\"close\":83785.63,\"high\":83880.45,\"low\":83725.5,\"amount\":0.06683703469243372,\"vol\":56,\"count\":20},{\"id\":1742386500,\"open\":83749.48,\"close\":83613.59,\"high\":83823.12,\"low\":83601.11,\"amount\":0.07167409960183023,\"vol\":60,\"count\":19},{\"id\":1742387400,\"open\":83648.04,\"close\":83663.86,\"high\":83787.82,\"low\":83541.15,\"amount\":0.06692808321503624,\"vol\":56,\"count\":18},{\"id\":1742388300,\"open\":83675.74,\"close\":83766.9,\"high\":83773.5,\"low\":83544.85,\"amount\":0.07175018111220081,\"vol\":60,\"count\":21},{\"id\":1742389200,\"open\":83755.35,\"close\":83940.5,\"high\":83952.25,\"low\":83686.9,\"amount\":0.0739805926965346,\"vol\":62,\"count\":18},{\"id\":1742390100,\"open\":83972.04,\"close\":83977.05,\"high\":84277.71,\"low\":83859.97,\"amount\":0.057119201992533,\"vol\":48,\"count\":19},{\"id\":1742391000,\"open\":83924.48,\"close\":83860.9,\"high\":83967.47,\"low\":83627.1,\"amount\":0.07870323205933885,\"vol\":66,\"count\":20},{\"id\":1742391900,\"open\":83896.33,\"close\":84120.31,\"high\":84287.29,\"low\":83896.33,\"amount\":0.07129565292540425,\"vol\":60,\"count\":19},{\"id\":1742392800,\"open\":84192.09,\"close\":84094.82,\"high\":84391.9,\"low\":84075.4,\"amount\":0.07596493272512464,\"vol\":64,\"count\":19},{\"id\":1742393700,\"open\":84229.77,\"close\":84155.69,\"high\":84285.44,\"low\":84011.46,\"amount\":0.0760403774699642,\"vol\":64,\"count\":18},{\"id\":1742394600,\"open\":83886.6,\"close\":84184.7,\"high\":84219.95,\"low\":83886.6,\"amount\":0.064226415943337,\"vol\":54,\"count\":20},{\"id\":1742395500,\"open\":84179.45,\"close\":84302.47,\"high\":84302.47,\"low\":84159.67,\"amount\":0.06648316675997404,\"vol\":56,\"count\":19},{\"id\":1742396400,\"open\":84284.91,\"close\":84229.95,\"high\":84469.29,\"low\":84229.95,\"amount\":0.07823642818159204,\"vol\":66,\"count\":20},{\"id\":1742397300,\"open\":84260.95,\"close\":84264.43,\"high\":84347.48,\"low\":84149.83,\"amount\":0.0759543952449043,\"vol\":64,\"count\":19},{\"id\":1742398200,\"open\":84304.35,\"close\":84701.9,\"high\":84704.75,\"low\":84278.46,\"amount\":0.07580482210212668,\"vol\":64,\"count\":19},{\"id\":1742399100,\"open\":84672.52,\"close\":84704.3,\"high\":84874.3,\"low\":84585.66,\"amount\":0.05664154439967866,\"vol\":48,\"count\":19},{\"id\":1742400000,\"open\":84730.42,\"close\":84520.26,\"high\":84789.85,\"low\":84520.26,\"amount\":0.06614615875280079,\"vol\":56,\"count\":19},{\"id\":1742400900,\"open\":84493.8,\"close\":84669.5,\"high\":84734.94,\"low\":84493.8,\"amount\":0.07563590045705418,\"vol\":64,\"count\":19},{\"id\":1742401800,\"open\":84706.07,\"close\":84444.17,\"high\":84706.07,\"low\":84444.17,\"amount\":0.0733251513598342,\"vol\":62,\"count\":19},{\"id\":1742402700,\"open\":84459.62,\"close\":84577.98,\"high\":84608.75,\"low\":84459.62,\"amount\":0.07096547375681594,\"vol\":60,\"count\":18},{\"id\":1742403600,\"open\":84562.65,\"close\":84515.0,\"high\":84731.22,\"low\":84515.0,\"amount\":0.07561855974220362,\"vol\":64,\"count\":20},{\"id\":1742404500,\"open\":84556.95,\"close\":84532.68,\"high\":84650.91,\"low\":84532.68,\"amount\":0.08511182201056941,\"vol\":72,\"count\":22},{\"id\":1742405400,\"open\":84488.69,\"close\":84028.49,\"high\":84518.76,\"low\":84028.49,\"amount\":0.0854134557267475,\"vol\":72,\"count\":22},{\"id\":1742406300,\"open\":83937.15,\"close\":84114.93,\"high\":84190.95,\"low\":83770.15,\"amount\":0.07850404866909226,\"vol\":66,\"count\":23},{\"id\":1742407200,\"open\":84064.25,\"close\":84428.36,\"high\":84581.51,\"low\":83594.85,\"amount\":0.07841919657549076,\"vol\":66,\"count\":22},{\"id\":1742408100,\"open\":84585.65,\"close\":84251.78,\"high\":84792.67,\"low\":84194.91,\"amount\":0.08051207320421559,\"vol\":68,\"count\":22},{\"id\":1742409000,\"open\":84364.75,\"close\":84562.24,\"high\":84588.96,\"low\":84284.4,\"amount\":0.0781209928489624,\"vol\":66,\"count\":23},{\"id\":1742409900,\"open\":84612.16,\"close\":85670.41,\"high\":85797.24,\"low\":84458.41,\"amount\":0.08460655190410975,\"vol\":72,\"count\":23},{\"id\":1742410800,\"open\":85865.33,\"close\":85653.57,\"high\":85916.74,\"low\":85393.65,\"amount\":0.08877262716540275,\"vol\":76,\"count\":23},{\"id\":1742411700,\"open\":85607.62,\"close\":85049.53,\"high\":85637.25,\"low\":85040.94,\"amount\":0.07264574802101088,\"vol\":62,\"count\":21},{\"id\":1742412600,\"open\":85144.23,\"close\":85445.21,\"high\":85478.49,\"low\":85099.5,\"amount\":0.07036418864810547,\"vol\":60,\"count\":18},{\"id\":1742413500,\"open\":85493.16,\"close\":85527.85,\"high\":85527.85,\"low\":85144.0,\"amount\":0.09136537376697035,\"vol\":78,\"count\":19},{\"id\":1742414400,\"open\":85434.55,\"close\":85633.44,\"high\":85713.33,\"low\":85434.55,\"amount\":0.06073497676352047,\"vol\":52,\"count\":18},{\"id\":1742415300,\"open\":85659.34,\"close\":85733.77,\"high\":85854.19,\"low\":85659.34,\"amount\":0.06764130221160741,\"vol\":58,\"count\":18},{\"id\":1742416200,\"open\":85719.92,\"close\":85429.57,\"high\":85719.92,\"low\":85429.57,\"amount\":0.05145464756807855,\"vol\":44,\"count\":18},{\"id\":1742417100,\"open\":85354.5,\"close\":85359.13,\"high\":85463.77,\"low\":85226.5,\"amount\":0.0773349632359768,\"vol\":66,\"count\":20},{\"id\":1742418000,\"open\":85385.67,\"close\":85549.62,\"high\":85549.62,\"low\":85385.67,\"amount\":0.0631825156783973,\"vol\":54,\"count\":19},{\"id\":1742418900,\"open\":85731.4,\"close\":85656.95,\"high\":85919.05,\"low\":85621.25,\"amount\":0.06065563098012371,\"vol\":52,\"count\":18},{\"id\":1742419800,\"open\":85642.2,\"close\":85594.95,\"high\":85793.44,\"low\":85589.45,\"amount\":0.06067316456292037,\"vol\":52,\"count\":19},{\"id\":1742420700,\"open\":85604.21,\"close\":85591.45,\"high\":85644.51,\"low\":85425.8,\"amount\":0.060768594493806685,\"vol\":52,\"count\":19},{\"id\":1742421600,\"open\":85731.05,\"close\":85865.95,\"high\":85877.2,\"low\":85704.65,\"amount\":0.06993352186638546,\"vol\":60,\"count\":20},{\"id\":1742422500,\"open\":85946.63,\"close\":85786.57,\"high\":85980.17,\"low\":85773.83,\"amount\":0.06756837555704717,\"vol\":58,\"count\":21},{\"id\":1742423400,\"open\":85849.67,\"close\":86327.59,\"high\":86414.7,\"low\":85826.61,\"amount\":0.06272961541508393,\"vol\":54,\"count\":20},{\"id\":1742424300,\"open\":86330.25,\"close\":86156.45,\"high\":86494.56,\"low\":86136.8,\"amount\":0.07413658416066818,\"vol\":64,\"count\":20},{\"id\":1742425200,\"open\":86355.21,\"close\":86367.0,\"high\":86425.26,\"low\":86204.08,\"amount\":0.06948428926306449,\"vol\":60,\"count\":19},{\"id\":1742426100,\"open\":86371.31,\"close\":86799.5,\"high\":86799.5,\"low\":86246.65,\"amount\":0.06937039971780172,\"vol\":60,\"count\":20},{\"id\":1742427000,\"open\":86794.3,\"close\":86944.01,\"high\":87013.25,\"low\":86724.97,\"amount\":0.07138614263035481,\"vol\":62,\"count\":19},{\"id\":1742427900,\"open\":86872.57,\"close\":86822.63,\"high\":86964.21,\"low\":86735.25,\"amount\":0.062181304682445294,\"vol\":54,\"count\":19},{\"id\":1742428800,\"open\":86868.32,\"close\":87302.25,\"high\":87388.4,\"low\":86868.32,\"amount\":0.06649479429751298,\"vol\":58,\"count\":18},{\"id\":1742429700,\"open\":87311.06,\"close\":86762.23,\"high\":87311.06,\"low\":86708.26,\"amount\":0.08503509985038445,\"vol\":74,\"count\":20},{\"id\":1742430600,\"open\":86741.43,\"close\":86507.74,\"high\":86876.99,\"low\":86441.73,\"amount\":0.07155788763202386,\"vol\":62,\"count\":18},{\"id\":1742431500,\"open\":86389.77,\"close\":86164.45,\"high\":86389.77,\"low\":86000.0,\"amount\":0.06031802396676594,\"vol\":52,\"count\":19},{\"id\":1742432400,\"open\":85998.67,\"close\":86271.9,\"high\":86353.2,\"low\":85866.61,\"amount\":0.055722191400382905,\"vol\":48,\"count\":20},{\"id\":1742433300,\"open\":86288.78,\"close\":86330.89,\"high\":86347.29,\"low\":86246.74,\"amount\":0.06720374802169034,\"vol\":58,\"count\":19},{\"id\":1742434200,\"open\":86300.49,\"close\":85875.06,\"high\":86300.49,\"low\":85875.06,\"amount\":0.06974447136796909,\"vol\":60,\"count\":20},{\"id\":1742435100,\"open\":85870.84,\"close\":85854.8,\"high\":85971.59,\"low\":85797.9,\"amount\":0.051228749624386886,\"vol\":44,\"count\":17},{\"id\":1742436000,\"open\":85853.95,\"close\":85777.6,\"high\":85918.12,\"low\":85684.05,\"amount\":0.08157828562683371,\"vol\":70,\"count\":21},{\"id\":1742436900,\"open\":85796.95,\"close\":85874.04,\"high\":85917.82,\"low\":85686.54,\"amount\":0.06991801147131056,\"vol\":60,\"count\":18},{\"id\":1742437800,\"open\":85805.5,\"close\":86040.1,\"high\":86040.1,\"low\":85782.2,\"amount\":0.05820344664153277,\"vol\":50,\"count\":19},{\"id\":1742438700,\"open\":85973.43,\"close\":86091.14,\"high\":86161.85,\"low\":85968.1,\"amount\":0.06972761811184364,\"vol\":60,\"count\":20},{\"id\":1742439600,\"open\":86126.93,\"close\":86043.62,\"high\":86185.15,\"low\":86020.75,\"amount\":0.0650429564369378,\"vol\":56,\"count\":19},{\"id\":1742440500,\"open\":85951.1,\"close\":85920.24,\"high\":86100.2,\"low\":85914.33,\"amount\":0.058151460913162284,\"vol\":50,\"count\":18},{\"id\":1742441400,\"open\":85944.06,\"close\":85999.71,\"high\":85999.71,\"low\":85880.86,\"amount\":0.07215024556608789,\"vol\":62,\"count\":20},{\"id\":1742442300,\"open\":85999.71,\"close\":85912.53,\"high\":86036.67,\"low\":85801.29,\"amount\":0.06982900042370511,\"vol\":60,\"count\":20},{\"id\":1742443200,\"open\":85917.71,\"close\":85862.01,\"high\":85927.26,\"low\":85831.25,\"amount\":0.05822054775554723,\"vol\":50,\"count\":18},{\"id\":1742444100,\"open\":85848.1,\"close\":85775.4,\"high\":85902.77,\"low\":85775.4,\"amount\":0.05824601067480249,\"vol\":50,\"count\":19},{\"id\":1742445000,\"open\":85812.78,\"close\":85593.74,\"high\":85812.78,\"low\":85593.74,\"amount\":0.07233783247901891,\"vol\":62,\"count\":20},{\"id\":1742445900,\"open\":85593.74,\"close\":85743.46,\"high\":85757.41,\"low\":85486.8,\"amount\":0.07005135061385502,\"vol\":60,\"count\":19},{\"id\":1742446800,\"open\":85750.62,\"close\":85698.45,\"high\":85764.37,\"low\":85631.55,\"amount\":0.0676727115220976,\"vol\":58,\"count\":21},{\"id\":1742447700,\"open\":85704.45,\"close\":85496.53,\"high\":85704.45,\"low\":85468.18,\"amount\":0.08180490487821192,\"vol\":70,\"count\":21},{\"id\":1742448600,\"open\":85562.19,\"close\":85667.34,\"high\":85698.0,\"low\":85536.7,\"amount\":0.06543711952110393,\"vol\":56,\"count\":17},{\"id\":1742449500,\"open\":85624.91,\"close\":85829.33,\"high\":85829.33,\"low\":85624.91,\"amount\":0.07928815790259845,\"vol\":68,\"count\":20},{\"id\":1742450400,\"open\":85870.64,\"close\":85967.87,\"high\":86023.72,\"low\":85820.05,\"amount\":0.07217459900669339,\"vol\":62,\"count\":19},{\"id\":1742451300,\"open\":86006.94,\"close\":85949.06,\"high\":86027.56,\"low\":85929.86,\"amount\":0.06746469939548344,\"vol\":58,\"count\":19},{\"id\":1742452200,\"open\":85878.2,\"close\":85745.59,\"high\":85937.16,\"low\":85652.97,\"amount\":0.08158966169880548,\"vol\":70,\"count\":20},{\"id\":1742453100,\"open\":85759.89,\"close\":85814.34,\"high\":85850.48,\"low\":85737.32,\"amount\":0.08158334132038557,\"vol\":70,\"count\":21},{\"id\":1742454000,\"open\":85759.02,\"close\":85983.43,\"high\":85983.43,\"low\":85720.7,\"amount\":0.06291907433978236,\"vol\":54,\"count\":18},{\"id\":1742454900,\"open\":85977.5,\"close\":85871.7,\"high\":85977.5,\"low\":85825.29,\"amount\":0.06752888364872871,\"vol\":58,\"count\":19},{\"id\":1742455800,\"open\":85850.25,\"close\":85823.28,\"high\":85918.18,\"low\":85791.69,\"amount\":0.06754744290605243,\"vol\":58,\"count\":19},{\"id\":1742456700,\"open\":85858.34,\"close\":85874.1,\"high\":85968.99,\"low\":85823.28,\"amount\":0.06519705456978049,\"vol\":56,\"count\":17},{\"id\":1742457600,\"open\":85855.92,\"close\":85817.23,\"high\":85930.42,\"low\":85733.42,\"amount\":0.07456851186192834,\"vol\":64,\"count\":20},{\"id\":1742458500,\"open\":85814.47,\"close\":86003.05,\"high\":86011.65,\"low\":85797.81,\"amount\":0.0791393986069678,\"vol\":68,\"count\":21},{\"id\":1742459400,\"open\":85810.65,\"close\":86098.49,\"high\":86110.0,\"low\":85810.65,\"amount\":0.07907215947238623,\"vol\":68,\"count\":21},{\"id\":1742460300,\"open\":86097.02,\"close\":86294.44,\"high\":86371.6,\"low\":86097.02,\"amount\":0.06493070449865196,\"vol\":56,\"count\":20},{\"id\":1742461200,\"open\":86301.83,\"close\":86170.75,\"high\":86314.05,\"low\":86152.82,\"amount\":0.0719038240547683,\"vol\":62,\"count\":18},{\"id\":1742462100,\"open\":86152.9,\"close\":86050.09,\"high\":86187.09,\"low\":86030.05,\"amount\":0.0696676774358424,\"vol\":60,\"count\":19},{\"id\":1742463000,\"open\":86006.66,\"close\":86058.4,\"high\":86129.81,\"low\":85974.33,\"amount\":0.07208100067853788,\"vol\":62,\"count\":20},{\"id\":1742463900,\"open\":86039.6,\"close\":85901.39,\"high\":86040.6,\"low\":85810.11,\"amount\":0.07212560236205912,\"vol\":62,\"count\":19},{\"id\":1742464800,\"open\":85910.94,\"close\":85564.45,\"high\":85966.24,\"low\":85564.45,\"amount\":0.07226610780647531,\"vol\":62,\"count\":19},{\"id\":1742465700,\"open\":85690.24,\"close\":85193.18,\"high\":85690.24,\"low\":84816.15,\"amount\":0.07741555414234119,\"vol\":66,\"count\":21},{\"id\":1742466600,\"open\":85208.33,\"close\":85255.46,\"high\":85285.25,\"low\":85057.27,\"amount\":0.07747055315714718,\"vol\":66,\"count\":22},{\"id\":1742467500,\"open\":85289.54,\"close\":85183.07,\"high\":85337.13,\"low\":85137.33,\"amount\":0.06805532795975075,\"vol\":58,\"count\":18},{\"id\":1742468400,\"open\":85129.36,\"close\":85250.29,\"high\":85290.4,\"low\":85129.36,\"amount\":0.06570595198107514,\"vol\":56,\"count\":22},{\"id\":1742469300,\"open\":85217.08,\"close\":85269.22,\"high\":85366.28,\"low\":85184.7,\"amount\":0.07036374773153514,\"vol\":60,\"count\":19},{\"id\":1742470200,\"open\":85286.8,\"close\":85452.54,\"high\":85486.95,\"low\":85274.76,\"amount\":0.05621604455115305,\"vol\":48,\"count\":18},{\"id\":1742471100,\"open\":85460.92,\"close\":85434.14,\"high\":85460.92,\"low\":85393.34,\"amount\":0.0702277669382353,\"vol\":60,\"count\":18},{\"id\":1742472000,\"open\":85589.17,\"close\":85437.4,\"high\":85589.17,\"low\":85266.33,\"amount\":0.08431175974041219,\"vol\":72,\"count\":18},{\"id\":1742472900,\"open\":85392.89,\"close\":85328.54,\"high\":85573.61,\"low\":85328.54,\"amount\":0.05849633105320546,\"vol\":50,\"count\":19},{\"id\":1742473800,\"open\":85439.99,\"close\":85272.75,\"high\":85452.69,\"low\":85150.94,\"amount\":0.060927226174957716,\"vol\":52,\"count\":19},{\"id\":1742474700,\"open\":85277.2,\"close\":85273.66,\"high\":85313.45,\"low\":85202.69,\"amount\":0.05864809324766132,\"vol\":50,\"count\":19},{\"id\":1742475600,\"open\":85313.45,\"close\":85274.41,\"high\":85313.45,\"low\":85102.59,\"amount\":0.07509353937313694,\"vol\":64,\"count\":18},{\"id\":1742476500,\"open\":85265.89,\"close\":85096.22,\"high\":85320.93,\"low\":85055.65,\"amount\":0.07512313204121993,\"vol\":64,\"count\":21},{\"id\":1742477400,\"open\":85145.55,\"close\":85567.74,\"high\":85666.85,\"low\":85145.55,\"amount\":0.07025048878443958,\"vol\":60,\"count\":19},{\"id\":1742478300,\"open\":85606.15,\"close\":85449.56,\"high\":85825.25,\"low\":85400.03,\"amount\":0.0584412532297391,\"vol\":50,\"count\":19},{\"id\":1742479200,\"open\":85547.78,\"close\":85968.42,\"high\":86088.8,\"low\":85547.78,\"amount\":0.08149072010303271,\"vol\":70,\"count\":20},{\"id\":1742480100,\"open\":85999.68,\"close\":86294.18,\"high\":86432.43,\"low\":85999.68,\"amount\":0.08350802171155587,\"vol\":72,\"count\":23},{\"id\":1742481000,\"open\":86216.98,\"close\":86222.53,\"high\":86289.8,\"low\":86119.89,\"amount\":0.064968066004133,\"vol\":56,\"count\":20},{\"id\":1742481900,\"open\":86203.11,\"close\":86130.97,\"high\":86285.85,\"low\":85952.65,\"amount\":0.088248990831218,\"vol\":76,\"count\":23},{\"id\":1742482800,\"open\":86050.54,\"close\":86018.33,\"high\":86050.54,\"low\":85378.9,\"amount\":0.07227839032908309,\"vol\":62,\"count\":19},{\"id\":1742483700,\"open\":85891.56,\"close\":85646.91,\"high\":85903.38,\"low\":85596.1,\"amount\":0.06532584441959473,\"vol\":56,\"count\":21},{\"id\":1742484600,\"open\":85608.1,\"close\":85048.34,\"high\":85608.1,\"low\":84984.65,\"amount\":0.07745157786700728,\"vol\":66,\"count\":21},{\"id\":1742485500,\"open\":85119.54,\"close\":84670.15,\"high\":85368.97,\"low\":84602.4,\"amount\":0.06355064597875508,\"vol\":54,\"count\":20},{\"id\":1742486400,\"open\":84763.97,\"close\":84425.03,\"high\":84842.73,\"low\":84335.15,\"amount\":0.06620920939788594,\"vol\":56,\"count\":18},{\"id\":1742487300,\"open\":84429.97,\"close\":84082.59,\"high\":84560.49,\"low\":84082.59,\"amount\":0.06875891367261146,\"vol\":58,\"count\":21},{\"id\":1742488200,\"open\":84011.79,\"close\":83833.51,\"high\":84180.4,\"low\":83798.35,\"amount\":0.07618540349213704,\"vol\":64,\"count\":20},{\"id\":1742489100,\"open\":83908.22,\"close\":83735.6,\"high\":83908.22,\"low\":83651.51,\"amount\":0.06685133724447963,\"vol\":56,\"count\":21},{\"id\":1742490000,\"open\":83731.81,\"close\":84110.95,\"high\":84110.95,\"low\":83717.86,\"amount\":0.059599510006867466,\"vol\":50,\"count\":19},{\"id\":1742490900,\"open\":84105.54,\"close\":83718.7,\"high\":84126.2,\"low\":83704.33,\"amount\":0.07626310270050218,\"vol\":64,\"count\":21},{\"id\":1742491800,\"open\":83791.59,\"close\":84219.81,\"high\":84219.81,\"low\":83791.59,\"amount\":0.05714425381399728,\"vol\":48,\"count\":19},{\"id\":1742492700,\"open\":84323.35,\"close\":84002.68,\"high\":84323.35,\"low\":83876.2,\"amount\":0.06661353202012918,\"vol\":56,\"count\":19},{\"id\":1742493600,\"open\":84059.15,\"close\":84153.53,\"high\":84162.02,\"low\":83948.1,\"amount\":0.07614128608314176,\"vol\":64,\"count\":20},{\"id\":1742494500,\"open\":84084.41,\"close\":83960.18,\"high\":84249.8,\"low\":83912.49,\"amount\":0.07137363692596978,\"vol\":60,\"count\":18},{\"id\":1742495400,\"open\":83896.0,\"close\":83894.11,\"high\":84180.94,\"low\":83894.11,\"amount\":0.066663175930917,\"vol\":56,\"count\":20},{\"id\":1742496300,\"open\":83981.9,\"close\":83973.91,\"high\":84104.18,\"low\":83943.55,\"amount\":0.07140961289482346,\"vol\":60,\"count\":21},{\"id\":1742497200,\"open\":84061.24,\"close\":83971.03,\"high\":84061.24,\"low\":83860.15,\"amount\":0.08097477715501256,\"vol\":68,\"count\":21},{\"id\":1742498100,\"open\":83960.24,\"close\":83982.09,\"high\":84218.6,\"low\":83960.24,\"amount\":0.054706525134172415,\"vol\":46,\"count\":17},{\"id\":1742499000,\"open\":84016.4,\"close\":84307.13,\"high\":84307.13,\"low\":84016.4,\"amount\":0.06891964567397894,\"vol\":58,\"count\":21},{\"id\":1742499900,\"open\":84307.05,\"close\":84057.94,\"high\":84376.4,\"low\":84014.11,\"amount\":0.05936405494335816,\"vol\":50,\"count\":19},{\"id\":1742500800,\"open\":84125.71,\"close\":84228.0,\"high\":84237.51,\"low\":84125.71,\"amount\":0.05226733695866481,\"vol\":44,\"count\":16},{\"id\":1742501700,\"open\":84227.69,\"close\":84538.36,\"high\":84538.36,\"low\":84181.19,\"amount\":0.08295375963437425,\"vol\":70,\"count\":20},{\"id\":1742502600,\"open\":84484.42,\"close\":84551.09,\"high\":84551.09,\"low\":84392.45,\"amount\":0.06866591234993923,\"vol\":58,\"count\":18},{\"id\":1742503500,\"open\":84533.37,\"close\":84505.26,\"high\":84569.95,\"low\":84491.89,\"amount\":0.07335331231040813,\"vol\":62,\"count\":21},{\"id\":1742504400,\"open\":84535.92,\"close\":84354.64,\"high\":84537.94,\"low\":84316.65,\"amount\":0.06393846002813684,\"vol\":54,\"count\":19},{\"id\":1742505300,\"open\":84427.47,\"close\":84356.86,\"high\":84427.47,\"low\":84240.21,\"amount\":0.0664162736151259,\"vol\":56,\"count\":19},{\"id\":1742506200,\"open\":84431.85,\"close\":84518.91,\"high\":84544.9,\"low\":84381.58,\"amount\":0.06393866354488598,\"vol\":54,\"count\":19},{\"id\":1742507100,\"open\":84460.62,\"close\":84293.57,\"high\":84465.85,\"low\":84285.43,\"amount\":0.06637832023599449,\"vol\":56,\"count\":20},{\"id\":1742508000,\"open\":84310.5,\"close\":84293.42,\"high\":84598.74,\"low\":84192.13,\"amount\":0.06875359167771247,\"vol\":58,\"count\":21},{\"id\":1742508900,\"open\":84275.38,\"close\":84042.89,\"high\":84417.71,\"low\":84042.89,\"amount\":0.08075315936030361,\"vol\":68,\"count\":19},{\"id\":1742509800,\"open\":84042.89,\"close\":84175.51,\"high\":84175.51,\"low\":83988.61,\"amount\":0.07374595612716273,\"vol\":62,\"count\":20},{\"id\":1742510700,\"open\":84121.15,\"close\":84107.4,\"high\":84217.79,\"low\":84047.76,\"amount\":0.071300094850359,\"vol\":60,\"count\":19},{\"id\":1742511600,\"open\":84116.89,\"close\":83997.15,\"high\":84116.89,\"low\":83940.5,\"amount\":0.07138863450874658,\"vol\":60,\"count\":21},{\"id\":1742512500,\"open\":83949.15,\"close\":83961.29,\"high\":83984.35,\"low\":83881.89,\"amount\":0.0857607552443038,\"vol\":72,\"count\":21},{\"id\":1742513400,\"open\":83933.98,\"close\":84125.32,\"high\":84176.2,\"low\":83933.98,\"amount\":0.06421907858471952,\"vol\":54,\"count\":19},{\"id\":1742514300,\"open\":84108.82,\"close\":84193.47,\"high\":84301.45,\"low\":84108.82,\"amount\":0.05462562411221806,\"vol\":46,\"count\":19},{\"id\":1742515200,\"open\":84193.53,\"close\":84405.28,\"high\":84405.28,\"low\":84188.89,\"amount\":0.06642062022008013,\"vol\":56,\"count\":20},{\"id\":1742516100,\"open\":84389.3,\"close\":84267.34,\"high\":84401.08,\"low\":84183.39,\"amount\":0.05931120359704762,\"vol\":50,\"count\":18},{\"id\":1742517000,\"open\":84246.9,\"close\":84400.14,\"high\":84402.77,\"low\":84141.24,\"amount\":0.07115021833495039,\"vol\":60,\"count\":19},{\"id\":1742517900,\"open\":84409.94,\"close\":84426.77,\"high\":84477.37,\"low\":84393.53,\"amount\":0.07578962490210468,\"vol\":64,\"count\":21},{\"id\":1742518800,\"open\":84454.2,\"close\":84484.01,\"high\":84495.58,\"low\":84401.01,\"amount\":0.06393099904009827,\"vol\":54,\"count\":18},{\"id\":1742519700,\"open\":84446.14,\"close\":84343.69,\"high\":84459.05,\"low\":84308.25,\"amount\":0.06398354412475048,\"vol\":54,\"count\":19},{\"id\":1742520600,\"open\":84331.8,\"close\":84491.02,\"high\":84491.1,\"low\":84320.69,\"amount\":0.07816476661380456,\"vol\":66,\"count\":22},{\"id\":1742521500,\"open\":84491.02,\"close\":84732.72,\"high\":84744.42,\"low\":84461.73,\"amount\":0.07326263419205212,\"vol\":62,\"count\":20},{\"id\":1742522400,\"open\":84717.4,\"close\":84641.96,\"high\":84746.99,\"low\":84584.21,\"amount\":0.054323340804587804,\"vol\":46,\"count\":18},{\"id\":1742523300,\"open\":84592.75,\"close\":84570.93,\"high\":84612.75,\"low\":84504.84,\"amount\":0.07095755463627387,\"vol\":60,\"count\":20},{\"id\":1742524200,\"open\":84599.69,\"close\":84522.45,\"high\":84625.47,\"low\":84484.6,\"amount\":0.08278689336708625,\"vol\":70,\"count\":21},{\"id\":1742525100,\"open\":84509.07,\"close\":84663.93,\"high\":84699.6,\"low\":84509.07,\"amount\":0.07088817623443934,\"vol\":60,\"count\":19},{\"id\":1742526000,\"open\":84639.81,\"close\":84381.24,\"high\":84668.51,\"low\":84367.55,\"amount\":0.06627727115039472,\"vol\":56,\"count\":21}]}";
			JSONObject jsonObject = JSONObject.parseObject(resStr);
// 解析数据层
			JSONArray dataJSONArray = jsonObject.getJSONArray("data");
			List<KLineVO> kLineVOS = JSONArray.parseArray(dataJSONArray.toJSONString(), KLineVO.class);
			result.setData(kLineVOS);
		} else {
			result = hbdmMarketService.getKline(symbol, period, size);
		}

		if (CommonUtil.isEmpty(result)) {
			resultMap.put(ExchangeCST.RESULT_CODE, ExchangeCST.ERROR);
			resultMap.put(ExchangeCST.RESULT_INFO, "火币k线图接口调用失败，请稍候再试");
			return jsonRes();
		} else if (ExchangeCST.STATUS_ERROR.equals(result.getStatus())) {
			resultMap.put(ExchangeCST.RESULT_CODE, result.getErrCode());
			resultMap.put(ExchangeCST.RESULT_INFO, "huobi error: " + result.getErrMsg());
			return jsonRes();
		}

		List<KLineVO> kLineVOList = result.getData();
		total = kLineVOList.size();
		List<String> xAxis = new ArrayList<>();
		List<Long> volume = new ArrayList<>();
		Double[][] kLineData = new Double[total][4];

		int row = 0;
		for (KLineVO kLineVO : kLineVOList) {
			kLineData[row][0] = kLineVO.getOpen();
			kLineData[row][1] = kLineVO.getClose();
			kLineData[row][2] = kLineVO.getLow();
			kLineData[row][3] = kLineVO.getHigh();
			xAxis.add(CommonUtil.formatTimeAxis(kLineVO.getId()));
			volume.add(kLineVO.getVol());
			row++;
		}

		resultMap.put("total", total);
		resultMap.put("xAxis", xAxis);
		resultMap.put("volume", volume);
		resultMap.put("kLineData", kLineData);
		return jsonRes();
	}

	@ResponseBody
	@RequestMapping("detail/merged")
	public String merged(String symbol) {
		initResultMap();

		HuobiTickResult<KLineVO> result = hbdmMarketService.merged(symbol);

		if (CommonUtil.isEmpty(result)) {
			resultMap.put(ExchangeCST.RESULT_CODE, ExchangeCST.ERROR);
			resultMap.put(ExchangeCST.RESULT_INFO, "火币k线图接口调用失败，请稍候再试");
			return jsonRes();
		} else if (ExchangeCST.STATUS_ERROR.equals(result.getStatus())) {
			resultMap.put(ExchangeCST.RESULT_CODE, result.getErrCode());
			resultMap.put(ExchangeCST.RESULT_INFO, "huobi error: " + result.getErrMsg());
			return jsonRes();
		}

		return jsonObject(result.getTick());
	}
}
